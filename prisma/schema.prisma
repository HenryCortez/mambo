generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

// =====================================
// ENUMS
// =====================================

enum TYPES {
  OFFICE
  MEMORANDUM
}

enum CATEGORY {
  NORMAL
  ENCRYPTED
}

enum STATUS {
  DRAFT
  NOT_SENT
  SENT
}

// =====================================
// MODELS
// =====================================

model users {
  id         Int     @id @default(autoincrement())
  name       String?
  lastname   String?
  email      String  @unique
  password   String?
  parent_id  Int?
  mfaSecret  String? // <--- agregar
  mfaEnabled Boolean @default(false)
  // self-relation (parent-child)
  parent     users?  @relation("UserParent", fields: [parent_id], references: [id])
  children   users[] @relation("UserParent")

  // relations
  creations      creations[]
  sends_emitter  sends[]     @relation("SendEmitter")
  sends_receiver sends[]     @relation("SendReceiver")
}

model docs {
  id       Int       @id @default(autoincrement())
  name     String?
  url      String?
  password String?
  type     TYPES?
  category CATEGORY?

  // relations
  creations   creations[]
  sends       sends[]
  attachments attachments[]
  encryptions encryptions[]
}

model encryptions {
  id                Int    @id @default(autoincrement())
  id_doc            Int
  code_front        String
  length_front      Int
  frequencies_front Json
  code_back         String
  length_back       Int
  frequencies_back  Json

  doc docs @relation(fields: [id_doc], references: [id])
}

model sends {
  id          Int      @id @default(autoincrement())
  id_emisor   Int
  id_receptor Int
  id_doc      Int
  reading     Boolean?
  writing     Boolean?

  // relations
  emisor   users @relation("SendEmitter", fields: [id_emisor], references: [id])
  receptor users @relation("SendReceiver", fields: [id_receptor], references: [id])
  doc      docs  @relation(fields: [id_doc], references: [id])

  attachments attachments[]
}

model attachments {
  id      Int @id @default(autoincrement())
  id_send Int
  id_doc  Int

  send sends @relation(fields: [id_send], references: [id])
  doc  docs  @relation(fields: [id_doc], references: [id])
}

model creations {
  id      Int     @id @default(autoincrement())
  id_user Int
  id_doc  Int
  status  STATUS?
  details String?

  user users @relation(fields: [id_user], references: [id])
  doc  docs  @relation(fields: [id_doc], references: [id])
}
